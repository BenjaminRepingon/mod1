var MOD1;
(function(d){d.Map=function(c,f,e,d){this.indices=[];this.width=c;this.positions=[];this.normals=[];this.uvs=[];this.ground=new BABYLON.Mesh("Map",e);this.basicGround(c,f,c,f,e);this.drawMontains([[40,25,20],[20,10,70],[30,-10,70]],c);this.ground.setVerticesData(this.positions,BABYLON.VertexBuffer.PositionKind,!0);this.ground.setVerticesData(this.normals,BABYLON.VertexBuffer.NormalKind,!0);this.ground.setVerticesData(this.uvs,BABYLON.VertexBuffer.UVKind,!0);this.ground.setIndices(this.indices)};d.Map.prototype.getAltitude=
function(c,f){return this.positions[this.getCustomIndex(c,f,this.width)]};d.Map.prototype.getCustomIndex=function(c,f,e){return 3*(c*(e+1)+f)+1};d.Map.prototype.drawMontains=function(c,f){if(0!=c.length)for(var e=c.length-1;0<=e;e--)this.interpol(c[e][0],c[e][2],c[e][1],f)};d.Map.prototype.interpol=function(c,f,e,d){e=0>e?e+1:e;firstCollision=-1;for(var g=1;g<=Math.abs(40*e);g++){for(var h=0;360>=h;h+=.3)rad=3.14159*h/180,a=Math.ceil(c+g*Math.cos(rad)),b=Math.ceil(f+g*Math.sin(rad)),index=this.getCustomIndex(a,
b,d),newAltitude=e*Math.exp(-((a-c)*(a-c))/Math.abs(10*e)-(b-f)*(b-f)/Math.abs(10*e)),Math.abs(newAltitude)>Math.abs(this.positions[index])?this.positions[index]=newAltitude:this.positions[index]>newAltitude&&1>firstCollision&&(firstCollision=0,this.positions[index]=(1.15*this.positions[index]+newAltitude)/2);firstCollision=0==firstCollision?1:firstCollision}};d.Map.prototype.basicGround=function(c,f,e,d,g){var h;for(g=0;g<=d;g++)for(h=0;h<=e;h++){var k=new BABYLON.Vector3(h*c/e-c/2,0,(d-g)*f/d-f/
2),l=new BABYLON.Vector3(0,1,0);this.positions.push(k.x,k.y,k.z);this.normals.push(l.x,l.y,l.z);this.uvs.push(h/e,1-g/d)}for(g=0;g<d;g++)for(h=0;h<e;h++)this.indices.push(h+1+(g+1)*(e+1)),this.indices.push(h+1+g*(e+1)),this.indices.push(h+g*(e+1)),this.indices.push(h+(g+1)*(e+1)),this.indices.push(h+1+(g+1)*(e+1)),this.indices.push(h+g*(e+1))}})(MOD1||(MOD1={}));(function(d){d.Core=function(c){this.scene=c};d.Core.prototype.initScene=function(){d.scene(this.scene)}})(MOD1||(MOD1={}));MOD1.scene=function(d){var c=new BABYLON.FreeCamera("camera1",new BABYLON.Vector3(50,30,-70),d);c.setTarget(BABYLON.Vector3.Zero());c.attachControl(canvas,!0);(new BABYLON.HemisphericLight("light1",new BABYLON.Vector3(0,1,0),d)).intensity=.7;c=new MOD1.Map(100,100,d,2);c.ground.receiveShadows=!0;var f=new BABYLON.StandardMaterial("mat",d);f.diffuseColor=BABYLON.Color3.White();f.wireframe=!0;c.ground.material=f;f=BABYLON.Mesh.CreateBox("emitter0",.1,d);f.position.y=10;f.isVisible=!1;console.log(c.getAltitude(40,
20));console.log(c.getAltitude(40,22));c=new BABYLON.ParticleSystem("particles",100,d);c.particleTexture=new BABYLON.Texture("textures/flare.png",d);c.minSize=.1;c.maxSize=1;c.minLifeTime=.5;c.maxLifeTime=5;c.minEmitPower=.5;c.maxEmitPower=3;c.emitter=f;c.emitRate=10;c.blendMode=BABYLON.ParticleSystem.BLENDMODE_ONEONE;c.direction1=new BABYLON.Vector3(-1,1,-1);c.direction2=new BABYLON.Vector3(1,1,1);c.color1=new BABYLON.Color4(0,.5,1,1);c.color2=new BABYLON.Color4(0,.2,.5,1);c.gravity=new BABYLON.Vector3(0,
-10,0);c.start();c.updateFunction=function(c){for(var d=0;d<c.length;d++){var f=c[d];console.log("pok");f.position.y-.5<=ground.position.y&&(f.direction.y=0)}}};